define(["require", "exports", "../../common/packageConversion/enum/objectTypeEnum", "../../common/persistence/settings", "../../common/packageConversion/enum/dataTypeEnum", "../../common/packageConversion/enum/additionalMetaKeys", "../../common/packageConversion/mceConversionError", "./settingIds", "../../common/packageConversion/enum/arrayTypeEnum", "../../common/packageConversion/package", "../../common/packageConversion/meta"], function (require, exports, objectTypeEnum_1, settings_1, dataTypeEnum_1, additionalMetaKeys_1, mceConversionError_1, settingIds_1, arrayTypeEnum_1, package_1, meta_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var DataIds;
    (function (DataIds) {
        DataIds["ScaleId"] = "id";
        DataIds["ScaleName"] = "name";
        DataIds["ScaleMinXValue"] = "minXValue";
        DataIds["ScaleMinYValue"] = "minYValue";
        DataIds["ScaleMaxXValue"] = "maxXValue";
        DataIds["ScaleMaxYValue"] = "maxYValue";
        DataIds["ScaleSeriesIds"] = "seriesIds";
        DataIds["ScaleExpandState"] = "expandState";
    })(DataIds || (DataIds = {}));
    var ScalePackageAdapter = /** @class */ (function () {
        function ScalePackageAdapter() {
            //newest version of package format
            this.currentPackageVersion = 1;
            this.settingsType = "Scale";
            this.objectType = objectTypeEnum_1.ObjectType.SCALE;
        }
        ScalePackageAdapter.prototype.packageToSetting = function (packageData, container) {
            var _a, _b, _c;
            var setting = new settings_1.Settings(this.settingsType);
            if (((_a = packageData === null || packageData === void 0 ? void 0 : packageData.meta) === null || _a === void 0 ? void 0 : _a.dataType) === dataTypeEnum_1.DataType.OBJECT && ((_b = packageData === null || packageData === void 0 ? void 0 : packageData.meta) === null || _b === void 0 ? void 0 : _b[additionalMetaKeys_1.AdditionalMetaKeys.OBJECTTYPE]) === this.objectType) {
                switch ((_c = packageData === null || packageData === void 0 ? void 0 : packageData.meta) === null || _c === void 0 ? void 0 : _c[additionalMetaKeys_1.AdditionalMetaKeys.VERSION]) {
                    case 1:
                        setting = this.packageV1ToSetting(packageData, container);
                        break;
                    default:
                        throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.UNSUPPORTED_VERSION, this.objectType);
                }
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.UNSUPPORTED_TYPE, this.objectType);
            }
            return setting;
        };
        ScalePackageAdapter.prototype.packageV1ToSetting = function (packageData, container) {
            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6, _7, _8, _9, _10, _11, _12, _13, _14, _15, _16, _17, _18;
            var setting = new settings_1.Settings(this.settingsType);
            if (((_c = (_b = (_a = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _a === void 0 ? void 0 : _a[DataIds.ScaleId]) === null || _b === void 0 ? void 0 : _b.meta) === null || _c === void 0 ? void 0 : _c.dataType) === dataTypeEnum_1.DataType.STRING) {
                setting.setValue(settingIds_1.SettingIds.ScaleId, (_e = (_d = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _d === void 0 ? void 0 : _d[DataIds.ScaleId]) === null || _e === void 0 ? void 0 : _e.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleId);
            }
            if (((_h = (_g = (_f = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _f === void 0 ? void 0 : _f[DataIds.ScaleName]) === null || _g === void 0 ? void 0 : _g.meta) === null || _h === void 0 ? void 0 : _h.dataType) === dataTypeEnum_1.DataType.STRING) {
                setting.setValue(settingIds_1.SettingIds.ScaleName, (_k = (_j = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _j === void 0 ? void 0 : _j[DataIds.ScaleName]) === null || _k === void 0 ? void 0 : _k.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleName);
            }
            if (((_o = (_m = (_l = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _l === void 0 ? void 0 : _l[DataIds.ScaleExpandState]) === null || _m === void 0 ? void 0 : _m.meta) === null || _o === void 0 ? void 0 : _o.dataType) === dataTypeEnum_1.DataType.BOOLEAN) {
                setting.setValue(settingIds_1.SettingIds.ScaleExpandState, (_q = (_p = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _p === void 0 ? void 0 : _p[DataIds.ScaleExpandState]) === null || _q === void 0 ? void 0 : _q.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleExpandState);
            }
            if (((_t = (_s = (_r = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _r === void 0 ? void 0 : _r[DataIds.ScaleMinXValue]) === null || _s === void 0 ? void 0 : _s.meta) === null || _t === void 0 ? void 0 : _t.dataType) === dataTypeEnum_1.DataType.NUMBER) {
                setting.setValue(settingIds_1.SettingIds.ScaleMinXValue, (_v = (_u = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _u === void 0 ? void 0 : _u[DataIds.ScaleMinXValue]) === null || _v === void 0 ? void 0 : _v.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleMinXValue);
            }
            if (((_y = (_x = (_w = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _w === void 0 ? void 0 : _w[DataIds.ScaleMaxXValue]) === null || _x === void 0 ? void 0 : _x.meta) === null || _y === void 0 ? void 0 : _y.dataType) === dataTypeEnum_1.DataType.NUMBER) {
                setting.setValue(settingIds_1.SettingIds.ScaleMaxXValue, (_0 = (_z = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _z === void 0 ? void 0 : _z[DataIds.ScaleMaxXValue]) === null || _0 === void 0 ? void 0 : _0.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleMaxXValue);
            }
            if (((_3 = (_2 = (_1 = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _1 === void 0 ? void 0 : _1[DataIds.ScaleMinYValue]) === null || _2 === void 0 ? void 0 : _2.meta) === null || _3 === void 0 ? void 0 : _3.dataType) === dataTypeEnum_1.DataType.NUMBER) {
                setting.setValue(settingIds_1.SettingIds.ScaleMinYValue, (_5 = (_4 = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _4 === void 0 ? void 0 : _4[DataIds.ScaleMinYValue]) === null || _5 === void 0 ? void 0 : _5.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleMinYValue);
            }
            if (((_8 = (_7 = (_6 = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _6 === void 0 ? void 0 : _6[DataIds.ScaleMaxYValue]) === null || _7 === void 0 ? void 0 : _7.meta) === null || _8 === void 0 ? void 0 : _8.dataType) === dataTypeEnum_1.DataType.NUMBER) {
                setting.setValue(settingIds_1.SettingIds.ScaleMaxYValue, (_10 = (_9 = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _9 === void 0 ? void 0 : _9[DataIds.ScaleMaxYValue]) === null || _10 === void 0 ? void 0 : _10.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleMaxYValue);
            }
            if (((_13 = (_12 = (_11 = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _11 === void 0 ? void 0 : _11[DataIds.ScaleSeriesIds]) === null || _12 === void 0 ? void 0 : _12.meta) === null || _13 === void 0 ? void 0 : _13.dataType) === dataTypeEnum_1.DataType.ARRAY && ((_16 = (_15 = (_14 = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _14 === void 0 ? void 0 : _14[DataIds.ScaleSeriesIds]) === null || _15 === void 0 ? void 0 : _15.meta) === null || _16 === void 0 ? void 0 : _16[additionalMetaKeys_1.AdditionalMetaKeys.ARRAYTYPE]) === arrayTypeEnum_1.ArrayType.STRING) {
                setting.setValue(settingIds_1.SettingIds.ScaleSeriesIds, (_18 = (_17 = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _17 === void 0 ? void 0 : _17[DataIds.ScaleSeriesIds]) === null || _18 === void 0 ? void 0 : _18.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.ScaleSeriesIds);
            }
            return setting;
        };
        ScalePackageAdapter.prototype.settingToPackage = function (settingsData) {
            var settings = settings_1.Settings.create(settingsData);
            var scaleData = {};
            var packageStructure = {
                packages: new Array(),
                topLevelID: NaN
            };
            if (settings.type === this.settingsType) {
                var id = meta_1.Meta.createID();
                var additionalMetaKeys = [{ key: additionalMetaKeys_1.AdditionalMetaKeys.OBJECTTYPE, value: this.objectType }, { key: additionalMetaKeys_1.AdditionalMetaKeys.ID, value: id }, { key: additionalMetaKeys_1.AdditionalMetaKeys.VERSION, value: this.currentPackageVersion }];
                var scaleMeta = new meta_1.Meta(dataTypeEnum_1.DataType.OBJECT, additionalMetaKeys);
                var scaleIdData = settings.getValue(settingIds_1.SettingIds.ScaleId);
                if (scaleIdData !== undefined) {
                    scaleData[DataIds.ScaleId] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.STRING), scaleIdData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleId);
                }
                var scaleNameData = settings.getValue(settingIds_1.SettingIds.ScaleName);
                if (scaleNameData !== undefined) {
                    scaleData[DataIds.ScaleName] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.STRING), scaleNameData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleName);
                }
                var scaleExpandStateData = settings.getValue(settingIds_1.SettingIds.ScaleExpandState);
                if (scaleExpandStateData !== undefined) {
                    scaleData[DataIds.ScaleExpandState] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.BOOLEAN), scaleExpandStateData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleExpandState);
                }
                var scaleMinXValueData = settings.getValue(settingIds_1.SettingIds.ScaleMinXValue);
                if (scaleMinXValueData !== undefined) {
                    scaleData[DataIds.ScaleMinXValue] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.NUMBER), scaleMinXValueData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleMinXValue);
                }
                var scaleMaxXValueData = settings.getValue(settingIds_1.SettingIds.ScaleMaxXValue);
                if (scaleMaxXValueData !== undefined) {
                    scaleData[DataIds.ScaleMaxXValue] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.NUMBER), scaleMaxXValueData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleMaxXValue);
                }
                var scaleMinYValueData = settings.getValue(settingIds_1.SettingIds.ScaleMinYValue);
                if (scaleMinYValueData !== undefined) {
                    scaleData[DataIds.ScaleMinYValue] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.NUMBER), scaleMinYValueData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleMinYValue);
                }
                var scaleMaxYValueData = settings.getValue(settingIds_1.SettingIds.ScaleMaxYValue);
                if (scaleMaxYValueData !== undefined) {
                    scaleData[DataIds.ScaleMaxYValue] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.NUMBER), scaleMaxYValueData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleMaxYValue);
                }
                var scaleSeriesIdsData = settings.getValue(settingIds_1.SettingIds.ScaleSeriesIds);
                if (scaleSeriesIdsData !== undefined) {
                    var scaleSerieIdsMeta = new meta_1.Meta(dataTypeEnum_1.DataType.ARRAY, [{ key: additionalMetaKeys_1.AdditionalMetaKeys.ARRAYTYPE, value: arrayTypeEnum_1.ArrayType.STRING }]);
                    scaleData[DataIds.ScaleSeriesIds] = new package_1.Package(scaleSerieIdsMeta, scaleSeriesIdsData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, settingIds_1.SettingIds.ScaleSeriesIds);
                }
                var categoryPackage = new package_1.Package(scaleMeta, scaleData);
                packageStructure.packages.push(categoryPackage);
                packageStructure.topLevelID = id;
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.UNSUPPORTED_VERSION, this.settingsType);
            }
            return packageStructure;
        };
        return ScalePackageAdapter;
    }());
    exports.ScalePackageAdapter = ScalePackageAdapter;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NhbGVzUGFja2FnZUFkYXB0ZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvYXBwL21vZGVscy9jaGFydE1hbmFnZXJEYXRhTW9kZWwvc2NhbGVzUGFja2FnZUFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBZUEsSUFBSyxPQVNKO0lBVEQsV0FBSyxPQUFPO1FBQ1IseUJBQWMsQ0FBQTtRQUNkLDZCQUFrQixDQUFBO1FBQ2xCLHVDQUE0QixDQUFBO1FBQzVCLHVDQUE0QixDQUFBO1FBQzVCLHVDQUE0QixDQUFBO1FBQzVCLHVDQUE0QixDQUFBO1FBQzVCLHVDQUE0QixDQUFBO1FBQzVCLDJDQUFnQyxDQUFBO0lBQ3BDLENBQUMsRUFUSSxPQUFPLEtBQVAsT0FBTyxRQVNYO0lBRUQ7UUFRSTtZQU5BLGtDQUFrQztZQUNqQiwwQkFBcUIsR0FBVyxDQUFDLENBQUM7WUFNL0MsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7WUFDNUIsSUFBSSxDQUFDLFVBQVUsR0FBRywyQkFBVSxDQUFDLEtBQUssQ0FBQztRQUN2QyxDQUFDO1FBQ0QsOENBQWdCLEdBQWhCLFVBQWlCLFdBQXFCLEVBQUUsU0FBMEI7O1lBRTlELElBQUksT0FBTyxHQUFjLElBQUksbUJBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFekQsSUFBRyxPQUFBLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxJQUFJLDBDQUFFLFFBQVEsTUFBSyx1QkFBUSxDQUFDLE1BQU0sSUFBSSxPQUFBLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxJQUFJLDBDQUFHLHVDQUFrQixDQUFDLFVBQVUsT0FBTSxJQUFJLENBQUMsVUFBVSxFQUFFO2dCQUUxSCxjQUFPLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxJQUFJLDBDQUFHLHVDQUFrQixDQUFDLE9BQU8sR0FBRTtvQkFDbkQsS0FBSyxD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QUFHLGtCQUFrQixLQUFLLFNBQVMsRUFBRTtvQkFDakMsSUFBSSxpQkFBaUIsR0FBRyxJQUFJLFdBQUksQ0FBQyx1QkFBUSxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUMsR0FBRyxFQUFFLHVDQUFrQixDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUseUJBQVMsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2pILFNBQVMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLEdBQUcsSUFBSSxpQkFBTyxDQUFDLGlCQUFpQixFQUFFLGtCQUFrQixDQUFDLENBQUM7aUJBQzFGO3FCQUFNO29CQUNILE1BQU0sdUNBQWtCLENBQUMsaUJBQWlCLENBQUMsMkNBQXNCLENBQUMsWUFBWSxFQUFFLHVCQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7aUJBQzlHO2dCQUVELElBQUksZUFBZSxHQUFHLElBQUksaUJBQU8sQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBRXhELGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQ2hELGdCQUFnQixDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7YUFDcEM7aUJBQU07Z0JBQ0gsTUFBTSx1Q0FBa0IsQ0FBQyxpQkFBaUIsQ0FBQywyQ0FBc0IsQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7YUFDN0c7WUFFRCxPQUFPLGdCQUFnQixDQUFDO1FBQzVCLENBQUM7UUFDTCwwQkFBQztJQUFELENBQUMsQUF2S0QsSUF1S0M7SUFFUSxrREFBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJUGFja2FnZUFkYXB0ZXIsIFBhY2thZ2VBcnJheVdpdGhUb3BMZXZlbElEIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9pbnRlcmZhY2UvcGFja2FnZUFkYXB0ZXJJbnRlcmZhY2VcIjtcclxuaW1wb3J0IHsgT2JqZWN0VHlwZSB9IGZyb20gXCIuLi8uLi9jb21tb24vcGFja2FnZUNvbnZlcnNpb24vZW51bS9vYmplY3RUeXBlRW51bVwiO1xyXG5pbXBvcnQgeyBJUGFja2FnZSB9IGZyb20gXCIuLi8uLi9jb21tb24vcGFja2FnZUNvbnZlcnNpb24vaW50ZXJmYWNlL3BhY2thZ2VJbnRlcmZhY2VcIjtcclxuaW1wb3J0IHsgRXhwb3J0Q29udGFpbmVyIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9leHBvcnRDb250YWluZXJcIjtcclxuaW1wb3J0IHsgSVNldHRpbmdzIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wZXJzaXN0ZW5jZS9pbnRlcmZhY2VzL3NldHRpbmdzSW50ZXJmYWNlXCI7XHJcbmltcG9ydCB7IFNldHRpbmdzIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wZXJzaXN0ZW5jZS9zZXR0aW5nc1wiO1xyXG5pbXBvcnQgeyBEYXRhVHlwZSB9IGZyb20gXCIuLi8uLi9jb21tb24vcGFja2FnZUNvbnZlcnNpb24vZW51bS9kYXRhVHlwZUVudW1cIjtcclxuaW1wb3J0IHsgQWRkaXRpb25hbE1ldGFLZXlzIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9lbnVtL2FkZGl0aW9uYWxNZXRhS2V5c1wiO1xyXG5pbXBvcnQgeyBNY2VDb252ZXJzaW9uRXJyb3IsIE1jZUNvbnZlcnNpb25FcnJvclR5cGUgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3BhY2thZ2VDb252ZXJzaW9uL21jZUNvbnZlcnNpb25FcnJvclwiO1xyXG5pbXBvcnQgeyBTZXR0aW5nSWRzIH0gZnJvbSBcIi4vc2V0dGluZ0lkc1wiO1xyXG5pbXBvcnQgeyBBcnJheVR5cGUgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3BhY2thZ2VDb252ZXJzaW9uL2VudW0vYXJyYXlUeXBlRW51bVwiO1xyXG5pbXBvcnQgeyBQYWNrYWdlIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9wYWNrYWdlXCI7XHJcbmltcG9ydCB7IE1ldGEgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3BhY2thZ2VDb252ZXJzaW9uL21ldGFcIjtcclxuXHJcblxyXG5lbnVtIERhdGFJZHMge1xyXG4gICAgU2NhbGVJZCA9IFwiaWRcIixcclxuICAgIFNjYWxlTmFtZSA9IFwibmFtZVwiLFxyXG4gICAgU2NhbGVNaW5YVmFsdWUgPSBcIm1pblhWYWx1ZVwiLFxyXG4gICAgU2NhbGVNaW5ZVmFsdWUgPSBcIm1pbllWYWx1ZVwiLFxyXG4gICAgU2NhbGVNYXhYVmFsdWUgPSBcIm1heFhWYWx1ZVwiLFxyXG4gICAgU2NhbGVNYXhZVmFsdWUgPSBcIm1heFlWYWx1ZVwiLFxyXG4gICAgU2NhbGVTZXJpZXNJZHMgPSBcInNlcmllc0lkc1wiLFxyXG4gICAgU2NhbGVFeHBhbmRTdGF0ZSA9IFwiZXhwYW5kU3RhdGVcIlxyXG59XHJcblxyXG5jbGFzcyBTY2FsZVBhY2thZ2VBZGFwdGVyIGltcGxlbWVudHMgSVBhY2thZ2VBZGFwdGVyIHtcclxuXHJcbiAgICAvL25ld2VzdCB2ZXJzaW9uIG9mIHBhY2thZ2UgZm9ybWF0XHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IGN1cnJlbnRQYWNrYWdlVmVyc2lvbjogbnVtYmVyID0gMTtcclxuXHJcbiAgICBwcml2YXRlIHNldHRpbmdzVHlwZTogc3RyaW5nO1xyXG4gICAgcHJpdmF0ZSBvYmplY3RUeXBlOiBPYmplY3RUeXBlO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3NUeXBlID0gXCJTY2FsZVwiO1xyXG4gICAgICAgIHRoaXMub2JqZWN0VHlwZSA9IE9iamVjdFR5cGUuU0NBTEU7XHJcbiAgICB9XHJcbiAgICBwYWNrYWdlVG9TZXR0aW5nKHBhY2thZ2VEYXRhOiBJUGFja2FnZSwgY29udGFpbmVyOiBFeHBvcnRDb250YWluZXIpOiBJU2V0dGluZ3Mge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBzZXR0aW5nOiBJU2V0dGluZ3MgPSBuZXcgU2V0dGluZ3ModGhpcy5zZXR0aW5nc1R5cGUpO1xyXG5cclxuICAgICAgICBpZihwYWNrYWdlRGF0YT8ubWV0YT8uZGF0YVR5cGUgPT09IERhdGFUeXBlLk9CSkVDVCAmJiBwYWNrYWdlRGF0YT8ubWV0YT8uW0FkZGl0aW9uYWxNZXRhS2V5cy5PQkpFQ1RUWVBFXSA9PT0gdGhpcy5vYmplY3RUeXBlKSB7XHJcbiAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHN3aXRjaChwYWNrYWdlRGF0YT8ubWV0YT8uW0FkZGl0aW9uYWxNZXRhS2V5cy5WRVJTSU9OXSl7IFxyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmcgPSB0aGlzLnBhY2thZ2VWMVRvU2V0dGluZyhwYWNrYWdlRGF0YSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRocm93IE1jZUNvbnZlcnNpb25FcnJvci5jcmVhdGVFcnJvckJ5VHlwZShNY2VDb252ZXJzaW9uRXJyb3JUeXBlLlVOU1VQUE9SVEVEX1ZFUlNJT04sIHRoaXMub2JqZWN0VHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5VTlNVUFBPUlRFRF9UWVBFLCB0aGlzLm9iamVjdFR5cGUpO1xyXG4gICAgICAgIH0gXHJcblxyXG4gICAgICAgIHJldHVybiBzZXR0aW5nO1xyXG4gICAgfSAgICBcclxuXHJcbiAgICBwcml2YXRlIHBhY2thZ2VWMVRvU2V0dGluZyhwYWNrYWdlRGF0YTogSVBhY2thZ2UsIGNvbnRhaW5lcjogRXhwb3J0Q29udGFpbmVyKTogSVNldHRpbmdzIHtcclxuXHJcbiAgICAgICAgbGV0IHNldHRpbmcgPSBuZXcgU2V0dGluZ3ModGhpcy5zZXR0aW5nc1R5cGUpO1xyXG5cclxuICAgICAgICBpZihwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2NhbGVJZF0/Lm1ldGE/LmRhdGFUeXBlID09PSBEYXRhVHlwZS5TVFJJTkcpIHtcclxuICAgICAgICAgICAgc2V0dGluZy5zZXRWYWx1ZShTZXR0aW5nSWRzLlNjYWxlSWQsIHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TY2FsZUlkXT8uZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNjYWxlSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2NhbGVOYW1lXT8ubWV0YT8uZGF0YVR5cGUgPT09IERhdGFUeXBlLlNUUklORykge1xyXG4gICAgICAgICAgICBzZXR0aW5nLnNldFZhbHVlKFNldHRpbmdJZHMuU2NhbGVOYW1lLCBwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2NhbGVOYW1lXT8uZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNjYWxlTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TY2FsZUV4cGFuZFN0YXRlXT8ubWV0YT8uZGF0YVR5cGUgPT09IERhdGFUeXBlLkJPT0xFQU4pIHtcclxuICAgICAgICAgICAgc2V0dGluZy5zZXRWYWx1ZShTZXR0aW5nSWRzLlNjYWxlRXhwYW5kU3RhdGUsIHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TY2FsZUV4cGFuZFN0YXRlXT8uZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNjYWxlRXhwYW5kU3RhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2NhbGVNaW5YVmFsdWVdPy5tZXRhPy5kYXRhVHlwZSA9PT0gRGF0YVR5cGUuTlVNQkVSKSB7XHJcbiAgICAgICAgICAgIHNldHRpbmcuc2V0VmFsdWUoU2V0dGluZ0lkcy5TY2FsZU1pblhWYWx1ZSwgcGFja2FnZURhdGE/LmRhdGE/LltEYXRhSWRzLlNjYWxlTWluWFZhbHVlXT8uZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNjYWxlTWluWFZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYocGFja2FnZURhdGE/LmRhdGE/LltEYXRhSWRzLlNjYWxlTWF4WFZhbHVlXT8ubWV0YT8uZGF0YVR5cGUgPT09IERhdGFUeXBlLk5VTUJFUikge1xyXG4gICAgICAgICAgICBzZXR0aW5nLnNldFZhbHVlKFNldHRpbmdJZHMuU2NhbGVNYXhYVmFsdWUsIHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TY2FsZU1heFhWYWx1ZV0/LmRhdGEpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IE1jZUNvbnZlcnNpb25FcnJvci5jcmVhdGVFcnJvckJ5VHlwZShNY2VDb252ZXJzaW9uRXJyb3JUeXBlLk1JU1NJTkdfREFUQSwgRGF0YUlkcy5TY2FsZU1heFhWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TY2FsZU1pbllWYWx1ZV0/Lm1ldGE/LmRhdGFUeXBlID09PSBEYXRhVHlwZS5OVU1CRVIpIHtcclxuICAgICAgICAgICAgc2V0dGluZy5zZXRWYWx1ZShTZXR0aW5nSWRzLlNjYWxlTWluWVZhbHVlLCBwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2NhbGVNaW5ZVmFsdWVdPy5kYXRhKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5NSVNTSU5HX0RBVEEsIERhdGFJZHMuU2NhbGVNaW5ZVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZihwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2NhbGVNYXhZVmFsdWVdPy5tZXRhPy5kYXRhVHlwZSA9PT0gRGF0YVR5cGUuTlVNQkVSKSB7XHJcbiAgICAgICAgICAgIHNldHRpbmcuc2V0VmFsdWUoU2V0dGluZ0lkcy5TY2FsZU1heFlWYWx1ZSwgcGFja2FnZURhdGE/LmRhdGE/LltEYXRhSWRzLlNjYWxlTWF4WVZhbHVlXT8uZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNjYWxlTWF4WVZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TY2FsZVNlcmllc0lkc10/Lm1ldGE/LmRhdGFUeXBlID09PSBEYXRhVHlwZS5BUlJBWSAmJiBwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2NhbGVTZXJpZXNJZHNdPy5tZXRhPy5bQWRkaXRpb25hbE1ldGFLZXlzLkFSUkFZVFlQRV0gPT09IEFycmF5VHlwZS5TVFJJTkcgKSB7XHJcbiAgICAgICAgICAgIHNldHRpbmcuc2V0VmFsdWUoU2V0dGluZ0lkcy5TY2FsZVNlcmllc0lkcywgcGFja2FnZURhdGE/LmRhdGE/LltEYXRhSWRzLlNjYWxlU2VyaWVzSWRzXT8uZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNjYWxlU2VyaWVzSWRzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXR0aW5nO1xyXG4gICAgfVxyXG5cclxuICAgIHNldHRpbmdUb1BhY2thZ2Uoc2V0dGluZ3NEYXRhOiBJU2V0dGluZ3MpOiBQYWNrYWdlQXJyYXlXaXRoVG9wTGV2ZWxJRCB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IHNldHRpbmdzID0gU2V0dGluZ3MuY3JlYXRlKHNldHRpbmdzRGF0YSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IHNjYWxlRGF0YTogeyBbaW5kZXg6IHN0cmluZ106ICBJUGFja2FnZSB9ICA9IHt9O1xyXG5cclxuICAgICAgICBsZXQgcGFja2FnZVN0cnVjdHVyZTogUGFja2FnZUFycmF5V2l0aFRvcExldmVsSUQgPSB7XHJcbiAgICAgICAgICAgIHBhY2thZ2VzOiBuZXcgQXJyYXk8SVBhY2thZ2U+KCksXHJcbiAgICAgICAgICAgIHRvcExldmVsSUQ6IE5hTlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcblxyXG4gICAgICAgIGlmKHNldHRpbmdzLnR5cGUgPT09IHRoaXMuc2V0dGluZ3NUeXBlKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgaWQgPSBNZXRhLmNyZWF0ZUlEKCk7XHJcbiAgICAgICAgICAgIGxldCBhZGRpdGlvbmFsTWV0YUtleXMgPSBbe2tleTogQWRkaXRpb25hbE1ldGFLZXlzLk9CSkVDVFRZUEUsIHZhbHVlOiB0aGlzLm9iamVjdFR5cGV9LCB7a2V5OiBBZGRpdGlvbmFsTWV0YUtleXMuSUQsIHZhbHVlOiBpZH0sIHtrZXk6IEFkZGl0aW9uYWxNZXRhS2V5cy5WRVJTSU9OLCB2YWx1ZTogdGhpcy5jdXJyZW50UGFja2FnZVZlcnNpb259XVxyXG4gICAgICAgICAgICBsZXQgc2NhbGVNZXRhID0gbmV3IE1ldGEoRGF0YVR5cGUuT0JKRUNULCBhZGRpdGlvbmFsTWV0YUtleXMpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgbGV0IHNjYWxlSWREYXRhID0gc2V0dGluZ3MuZ2V0VmFsdWUoU2V0dGluZ0lkcy5TY2FsZUlkKTtcclxuICAgICAgICAgICAgaWYoc2NhbGVJZERhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgc2NhbGVEYXRhW0RhdGFJZHMuU2NhbGVJZF0gPSBuZXcgUGFja2FnZShuZXcgTWV0YShEYXRhVHlwZS5TVFJJTkcpLCBzY2FsZUlkRGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5NSVNTSU5HX0RBVEEsIFNldHRpbmdJZHMuU2NhbGVJZCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBzY2FsZU5hbWVEYXRhID0gc2V0dGluZ3MuZ2V0VmFsdWUoU2V0dGluZ0lkcy5TY2FsZU5hbWUpO1xyXG4gICAgICAgICAgICBpZihzY2FsZU5hbWVEYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHNjYWxlRGF0YVtEYXRhSWRzLlNjYWxlTmFtZV0gPSBuZXcgUGFja2FnZShuZXcgTWV0YShEYXRhVHlwZS5TVFJJTkcpLCBzY2FsZU5hbWVEYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IE1jZUNvbnZlcnNpb25FcnJvci5jcmVhdGVFcnJvckJ5VHlwZShNY2VDb252ZXJzaW9uRXJyb3JUeXBlLk1JU1NJTkdfREFUQSwgU2V0dGluZ0lkcy5TY2FsZU5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgc2NhbGVFeHBhbmRTdGF0ZURhdGEgPSBzZXR0aW5ncy5nZXRWYWx1ZShTZXR0aW5nSWRzLlNjYWxlRXhwYW5kU3RhdGUpO1xyXG4gICAgICAgICAgICBpZihzY2FsZUV4cGFuZFN0YXRlRGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBzY2FsZURhdGFbRGF0YUlkcy5TY2FsZUV4cGFuZFN0YXRlXSA9IG5ldyBQYWNrYWdlKG5ldyBNZXRhKERhdGFUeXBlLkJPT0xFQU4pLCBzY2FsZUV4cGFuZFN0YXRlRGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5NSVNTSU5HX0RBVEEsIFNldHRpbmdJZHMuU2NhbGVFeHBhbmRTdGF0ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBzY2FsZU1pblhWYWx1ZURhdGEgPSBzZXR0aW5ncy5nZXRWYWx1ZShTZXR0aW5nSWRzLlNjYWxlTWluWFZhbHVlKTtcclxuICAgICAgICAgICAgaWYoc2NhbGVNaW5YVmFsdWVEYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHNjYWxlRGF0YVtEYXRhSWRzLlNjYWxlTWluWFZhbHVlXSA9IG5ldyBQYWNrYWdlKG5ldyBNZXRhKERhdGFUeXBlLk5VTUJFUiksIHNjYWxlTWluWFZhbHVlRGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5NSVNTSU5HX0RBVEEsIFNldHRpbmdJZHMuU2NhbGVNaW5YVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgc2NhbGVNYXhYVmFsdWVEYXRhID0gc2V0dGluZ3MuZ2V0VmFsdWUoU2V0dGluZ0lkcy5TY2FsZU1heFhWYWx1ZSk7XHJcbiAgICAgICAgICAgIGlmKHNjYWxlTWF4WFZhbHVlRGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBzY2FsZURhdGFbRGF0YUlkcy5TY2FsZU1heFhWYWx1ZV0gPSBuZXcgUGFja2FnZShuZXcgTWV0YShEYXRhVHlwZS5OVU1CRVIpLCBzY2FsZU1heFhWYWx1ZURhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBTZXR0aW5nSWRzLlNjYWxlTWF4WFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbGV0IHNjYWxlTWluWVZhbHVlRGF0YSA9IHNldHRpbmdzLmdldFZhbHVlKFNldHRpbmdJZHMuU2NhbGVNaW5ZVmFsdWUpO1xyXG4gICAgICAgICAgICBpZihzY2FsZU1pbllWYWx1ZURhdGEgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgc2NhbGVEYXRhW0RhdGFJZHMuU2NhbGVNaW5ZVmFsdWVdID0gbmV3IFBhY2thZ2UobmV3IE1ldGEoRGF0YVR5cGUuTlVNQkVSKSwgc2NhbGVNaW5ZVmFsdWVEYXRhKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IE1jZUNvbnZlcnNpb25FcnJvci5jcmVhdGVFcnJvckJ5VHlwZShNY2VDb252ZXJzaW9uRXJyb3JUeXBlLk1JU1NJTkdfREFUQSwgU2V0dGluZ0lkcy5TY2FsZU1pbllWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxldCBzY2FsZU1heFlWYWx1ZURhdGEgPSBzZXR0aW5ncy5nZXRWYWx1ZShTZXR0aW5nSWRzLlNjYWxlTWF4WVZhbHVlKTtcclxuICAgICAgICAgICAgaWYoc2NhbGVNYXhZVmFsdWVEYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHNjYWxlRGF0YVtEYXRhSWRzLlNjYWxlTWF4WVZhbHVlXSA9IG5ldyBQYWNrYWdlKG5ldyBNZXRhKERhdGFUeXBlLk5VTUJFUiksIHNjYWxlTWF4WVZhbHVlRGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5NSVNTSU5HX0RBVEEsIFNldHRpbmdJZHMuU2NhbGVNYXhZVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsZXQgc2NhbGVTZXJpZXNJZHNEYXRhID0gc2V0dGluZ3MuZ2V0VmFsdWUoU2V0dGluZ0lkcy5TY2FsZVNlcmllc0lkcyk7XHJcbiAgICAgICAgICAgIGlmKHNjYWxlU2VyaWVzSWRzRGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc2NhbGVTZXJpZUlkc01ldGEgPSBuZXcgTWV0YShEYXRhVHlwZS5BUlJBWSwgW3trZXk6IEFkZGl0aW9uYWxNZXRhS2V5cy5BUlJBWVRZUEUsIHZhbHVlOiBBcnJheVR5cGUuU1RSSU5HfV0pO1xyXG4gICAgICAgICAgICAgICAgc2NhbGVEYXRhW0RhdGFJZHMuU2NhbGVTZXJpZXNJZHNdID0gbmV3IFBhY2thZ2Uoc2NhbGVTZXJpZUlkc01ldGEsIHNjYWxlU2VyaWVzSWRzRGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5NSVNTSU5HX0RBVEEsIFNldHRpbmdJZHMuU2NhbGVTZXJpZXNJZHMpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgY2F0ZWdvcnlQYWNrYWdlID0gbmV3IFBhY2thZ2Uoc2NhbGVNZXRhLCBzY2FsZURhdGEpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcGFja2FnZVN0cnVjdHVyZS5wYWNrYWdlcy5wdXNoKGNhdGVnb3J5UGFja2FnZSk7XHJcbiAgICAgICAgICAgIHBhY2thZ2VTdHJ1Y3R1cmUudG9wTGV2ZWxJRCA9IGlkO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IE1jZUNvbnZlcnNpb25FcnJvci5jcmVhdGVFcnJvckJ5VHlwZShNY2VDb252ZXJzaW9uRXJyb3JUeXBlLlVOU1VQUE9SVEVEX1ZFUlNJT04sIHRoaXMuc2V0dGluZ3NUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIHJldHVybiBwYWNrYWdlU3RydWN0dXJlOyAgICAgICAgXHJcbiAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCB7IFNjYWxlUGFja2FnZUFkYXB0ZXIgfSJdfQ==